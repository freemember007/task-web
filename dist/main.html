<div class="task_container">

  <div class="left" ng-controller="SidebarController">
  <h1 class="company">杭州特扬网络</h1>
  <div class="left_container">
    <ul class="mySummary">
      <li  class="active" ng-repeat="x in summaryList.mySummary" ng-click="clickSidebar(x.field, userInfo.objectId)">
        <span class = "active" class="label">{{x.title}}</span>
        <span class="num">{{x.allNum}}</span>
      </li>
    </ul>
    <ul class="teamSummary">
      <li ng-repeat="team in summaryList.teamSummary">
        <p class="teamName " ng-click="clickSidebar('team', team.objectId)" ng-class="(currentParams.objectId == team.objectId) ? 'active' : ''" >
          <span class="label">{{team.name}}</span>
          <span class="num">{{team.allNum}}</span>
          <span class="icon"></span>
        </p>
        <ul class="team_group">
          <li class="team_one" ng-repeat="member in team.members" ng-click="clickSidebar('assignee', member.objectId)" ng-class="(currentParams.objectId == member.objectId) ? 'active' : ''">
            <img ng-src="http://file.bmob.cn/{{member.avatar.url}}" ng-if="member.avatar.url" />
            <img ng-src="img/avatar_default.png" ng-if="!member.avatar.url" />
            <span class="name">{{member.name}}</span>
            <span class="num">{{member.allNum}}</span>
          </li>
        </ul>
      </li>
    </ul>
  </div>
</div> 
  <div class="right" ng-controller="TaskListController">
  <!--顶部导航栏-->
  <div class="right_top">
    <div class="container">
      <div class="head">
        <span class="add_task">
          新建一个任务
        </span>
        <span class="notification_container">
          <ul class="notification">
            <li ng-repeat="notification in notifications" ng-click="clickNotification({'subject': 'assignee','objectId':notification.assigneeId,'taskId':notification.taskId})">
              <img ng-src="{{notification.updaterAvatar}}">
              <div class="message">
                {{notification.message}}
              </div>
            </li>
          </ul>
        </span>
      <span class="user">
          <span class="username" ng-click="showNotification()">
            <!-- {{userInfo.name}} -->
          </span>
      <img class="thumb" src="http://file.bmob.cn/{{userInfo.avatar.url}}" ng-click="logout()">
      </span>
    </div>
    <ul class="menu">
      <li ng-click="filterTaskList(0)">
        待办
        <span class="number">{{length[0]}}</span>
      </li>
      <li id="default" class="active" ng-click="filterTaskList(1)">
        进行
        <span class="number">{{length[1]}}</span>
      </li>
      <li ng-click="filterTaskList(2)">
        完成
        <span class="number">{{length[2]}}</span>
      </li>
      <li ng-click="filterTaskList(3)">
        搁置
        <span class="number">{{length[3]}}</span>
      </li>
    </ul>
  </div>
</div>
<!--主要内容展示区域-->
<div class="main">
  <div class="taskList">
    <ul class="dates" ng-repeat="x in taskList">
      <p class="date">
        <span class="days" ng-class="{'past': x.delay}">{{x.groupName}}</span>
        <span class="date">{{x.subGroupName}}</span>
      </p>
      <li ng-repeat="d in x.tasks" ng-click="showTaskDetail(d.objectId)">
        <div class="avator">
          <div class="thumb" ng-show="myself" ng-click="completeTask(d.objectId)"><img src="img/icon_complete.png" /></div>
          <div class="thumb" ng-show="!myself"><img ng-src="http://file.bmob.cn/{{d.assignee.avatar.url}}" ng-click="getTaskList({'subject':'assignee','objectId':d.assignee.objectId})" /></div>
          <span class="priority"></span>
          <span class="taskName" ng-class="{'past': x.delay}" ng-if="!done">{{d.title}}</span>
          <span class="taskName finished" ng-class="{'past': x.delay}" ng-if="done">{{d.title}}</span>
          <span class="project" ng-style="{'background': d.project.color.replace('#99','#')}">{{d.project.name}}</span>
        </div>
        <div class="other">
          <span class="like" ng-if="!myself"></span>
        </div>
      </li>
    </ul>
  </div>
  <div class="taskDetail">
  </div>
</div>
</div>

</div>

<div class="createTask" ng-controller="CreatTaskController">
  <div class="mask">
    <div class="container">

      <!-- 任务名 -->
      <p>
        <span id="time">{{task.createdAt}}</span>
        <span class="assigner">由{{userInfo.name}}创建</span>
      </p>
      <p class="taskName">
        <input id="taskName" type="text" focus placeholder="请输入任务名称" ng-model="task.title" />
      </p>

      <!-- 选项 -->
      <ul class="opt">

        <!-- 选择项目 -->
        <li class="projectName">
          <span class="color"></span>
          <span class="name">{{task.project.name}}</span>
          <ul class="projectList">
            <li ng-repeat="project in companyInfo.projects" ng-click="task.project = project">
              {{project.name}}
            </li>
          </ul>
        </li>

        <!-- 选择截止时间 -->
        <li class="deadline">
          <span class="name">{{task.deadlineFormat}}</span>
          <ul class="dateList">
            <li ng-repeat="date in dateList" ng-click="task.deadlineFormat = date.deadlineFormat; task.deadline=date.deadline">
              {{date.deadlineFormat}}
            </li>
          </ul>
        </li>

        <!-- 选择责任人 -->
        <li class="assigneeName">
          <span class="thumb"><img ng-src="{{task.assigneeAvatar}}"/></span>
          <span class="memberName">{{task.assigneeName}}</span>
          <ul class="assigneeList">
            <li ng-repeat="team in companyInfo.teams">
              ------ {{team.name}} ------
              <ul>
                <li ng-repeat="member in team.members" ng-click="task.assigneeName = member.name; task.assignee = member.objectId; task.team = team.objectId; task.assigneeAvatar = 'http://file.bmob.cn/' + member.avatar.url">
                  <span class="thumb"><img src="http://file.bmob.cn/{{member.avatar.url}}"/></span>
                  <span class="memberName">{{member.name}}</span>
                </li>
              </ul>
            </li>
          </ul>
        </li>

        <!-- 选择优先级 -->
        <li class="priority">优先级：
          <select class="priorityValue" ng-model="task.priority">
            <option value="0" name = "不紧急" >不紧急</option>
            <option value="1">一般紧急</option>
            <option value="2">紧急</option>
            <option value="3">非常紧急</option>
          </select>
        </li>
      </ul>

      <!-- 提交 -->
      <p class="submit">
        <span class="button" ng-click="createTask()">发布任务</span>
      </p>
      <span class="close">
      </span>
    </div>
  </div>
</div>
<div id="task_detail_container" ng-controller="TaskDetailController">
  <div id="task_detail">
    <!-- 头部区 -->
    <div class="head_chunk">
      {{task.createdAt}}<span>由{{task.assigner.name}}创建</span>
      <!-- <img class="icon_close" src="img/icon_close.png"> -->
    </div>
    <div class="title">
      <input type="text" class="taskNameInput" placeholder="请输入任务名称" ng-model="task.title" ng-keydown="completeTask($event)"/>
    </div>
    <!-- 内容区 -->
    <ul class="content">
      <!-- 项目 -->
      <li class="project_container">
        <div class="project toggle_child">
          <span class="project_color" ng-style="{'background': task.project.color.replace('#99','#')}"></span>
          <!-- <span class="project_name"></span> -->
          {{task.project.name}}
          <ul class="project_list">
            <li class="project" ng-repeat="project in companyInfo.projects track by $index" ng-click="task.project = project;updateTask({'project': project})">
              <span class="project_color" ng-style="{'background': project.color.replace('#99','#')}"></span>
              {{project.name}}
            </li>
          </ul>
        </div>
      </li>
      <!-- 责任人 -->
      <li class="assignee_container">
        <div class="assignee toggle_child">
          <img src="http://file.bmob.cn/{{task.assignee.avatar.url}}">
          {{task.assignee.name}}
          <ul class="assignee_list">
            <li ng-repeat="team in companyInfo.teams">
              ------ {{team.name}} ------
              <ul>
                <li class="assignee" ng-repeat="member in team.members"  ng-click="task.assignee=member;updateTask({'team':team.objectId,'assignee':member.objectId})">
                  <img src="http://file.bmob.cn/{{member.avatar.url}}">
                  {{member.name}}
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </li>
      <!-- 到期时间 -->
      <li class="deadline_container">
        <div class="deadline toggle_child">
          {{task.deadline.iso||'无期限'}}
          <ul class="deadline_list">
            <li class="deadline" ng-repeat="deadline in deadlineList" ng-click="task.deadline.iso=deadline;updateTask({'deadline': deadline,'status': 1})">
              {{deadline}}
            </li>
          </ul>
        </div>
      </li>
      <!-- 优先级 -->
      <li class="priority_container">
        <div class="priority toggle_child">
          {{priorityList[task.priority]}}
          <ul class="priority_list">
            <li class="priority" ng-repeat="priority in priorityList" ng-click="task.priority = $index;updateTask({'priority': $index})">
              {{priority}}
            </li>
          </ul>
        </div>
      </li>

      <!-- 附件 -->
      <li class="file_container">
        <a ng-href="http://file.bmob.cn/{{task.file.url}}" target="_blank">
          <img src="http://file.bmob.cn/{{task.file.url}}">
        </a>
        
      </li>

      <!-- 子任务 -->
      <li class="checklist_container">
        <ul>
          <!-- <li>
            患者管理页面修改<img src="img/icon_close.png">
          </li> -->
          <li>
            <input type="text" placeholder="添加子任务"/>
          </li>
        </ul>
      </li>
      <!-- 评论 -->
      <li class="comments">
        <ul>
          <li ng-repeat="comment in task.comments">
            <div class="comment_user">
              <img ng-src="{{comment.userUrl}}">
              <span class="comment_name">{{comment.userName}}</span>
              <span class="comment_createdAt">{{comment.sendTimg}}</span>
            </div>
            <div class="comment_content">
              {{comment.userMsg}}
            </div>
          </li>
          <li>
            <div class="add_comment">
              <input type="text" placeholder="添加评论" ng-model="task.newComment" ng-keydown="addComment($event)" />
            </div>
          </li>
        </ul>
      </li>
    </ul>
    <!--   <div class="foot_chunk">
    删除改任务
  </div> -->
  </div>
  <div class="floating_panel_close">
    <i class="icon_close">X</i>
  </div>
</div>